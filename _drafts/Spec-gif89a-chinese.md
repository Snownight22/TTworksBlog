---
layout: post
title:  gif89a规范-中文翻译
date:   2022-11-01 14:36:00 +0800
categories: 音视频基础
tag: 翻译
---

目录

免责声明   ---------------------------------1  
序   -----------------------------------------1  
许可  ---------------------------------------1  
关于本文档  ------------------------------2  
总则   --------------------------------------2  
版本号   -----------------------------------2  
编码器   -----------------------------------3  
解码器   -----------------------------------3  
守则   --------------------------------------3  
关于建议   --------------------------------4  
关于颜色表   -----------------------------4  
块，扩展和作用域   --------------------4  
块大小   -----------------------------------5  
使用GIF作为嵌入式协议   -------------5  
数据子块   --------------------------------5  
块结束符   --------------------------------6  
头   -----------------------------------------7  
逻辑屏幕标识符   ------------------------8  
全局颜色表   ------------------------------10  
图像标识符   ------------------------------11  
局部颜色表   ------------------------------13  
基于表格的图像数据   -------------------14  
图像控制扩展   ----------------------------15  
注释扩展   ----------------------------------17  
纯文本扩展   -------------------------------18  
应用程序扩展   ----------------------------21  
Trailer   ------------------------------------23  
快速参考表   ------------------------------24  
GIF语法   ----------------------------------25  
术语表   ------------------------------------27  
约定   ---------------------------------------28  
隔行图像   ---------------------------------29  
变长编码LZW压缩   ---------------------30  
在线功能对话   ---------------------------33  


#### 1. 免责声明    {#Disclaimer}

以上资料如有更改，恕不另行通知。在任何情况下，CompuServe 公司都不承担损害赔偿责任，包括因使用或无法使用信息而导致的任何收入损失、利润损失或其他附带或间接损害;CompuServe 公司对信息的适用性不作任何声明。  


#### 2. 序    {#Foreword}

本文档定义了图形交换格式(sm)。这个规范定义了版本 89a，它是版本 87a 的扩展。  

此处指定的图形交换格式(sm)应被视为完整的;任何偏离它的行为都应该被认为是无效的，包括但不限于，在控制或数据块中使用保留的或未定义的字段，在块内部或块之间包含无关的数据，使用格式中没有特别列出的方法或算法，等等。一般而言，本文档中未指明的任何偏离、扩展或修改都应被视为违反格式，应当避免。  

#### 3. 许可    {#Licensing}

图形交换格式(c)是 CompuServe 公司的版权财产。只有 CompuServe 公司有权以任何方式定义、重新定义、增强、更改、修改或更改格式的定义。  

CompuServe 公司特此授予在计算机软件中使用图形交换格式(sm)的有限的、非独占的、免版税的许可;使用 GIF(sm) 的计算机软件必须在用户和技术文档中承认 CompuServe 公司对图形交换格式及其服务标记的所有权。使用 GIF 的计算机软件，在没有用户或技术文档的情况下分发或可能分发时，必须在屏幕或打印机上显示一条消息，确认 CompuServe 对图形交换格式和服务标记的所有权。可以使用如下的消息：  

    "The Graphics Interchange Format(c) is the Copyright property of
      CompuServe Incorporated. GIF(sm) is a Service Mark property of
      CompuServe Incorporated."  

如需更多信息，请联系：  

    CompuServe Incorporated  
    Graphics Technology Department  
    5000 Arlington Center Boulevard  
    Columbus, Ohio  43220  
    U. S. A.    

CompuServe公司与所有希望在本文件更正或修订后收到副本的个人和组织保持了一个邮件列表。这项服务是免费提供的;请提供您的邮寄地址。  

#### 4. 关于本文档    {#AboutDoc}

本文档详细描述了图形交换格式的定义。本文档旨在作为编程参考;建议在编程之前仔细阅读整个文档，因为各个部分是相互依赖的。每个格式块都有一个单独的部分。在每个部分中，标记为 `需要的版本`的子部分指的是如果在数据流中使用了相应的块，编码器将必须使用的版本号。每个部分中，用一个图表描述了块中的各个字段;这些图表是垂直画的;图中的顶部字节首先出现在数据流中。一个字节内的位被画在最有效的左边。多字节数字字段顺序为最低有效字节优先。数值常量表示为十六进制数，前面加“0x”。字节内的位字段按从最高有效位到最低有效位的顺序描述。  

#### 5. 总则    {#General}

图形交换格式(sm)定义了一种用于位图数据在线传输和交换的协议，其方式与创建或显示所用的硬件无关。  

图形交换格式是根据用于图形重建的相关参数和数据的块和子块来定义的。GIF 数据流是协议块和子块的序列，表示图形的集合。通常，假设数据流中的图形在某种程度上是相关的，并共享一些控制信息;建议编码器尝试将相关图形组合在一起，以最小化处理过程中的硬件更改和最小化控制信息开销。同样的，不相关的图形或需要重新设置硬件参数的图形应尽可能单独编码。  

数据流可能起源于本地，如从文件中读取时，也可能起源于远程，如通过数据通信线传输时。格式的定义假设使用无错误的传输层协议进行通信;格式对错误检测和错误纠正没有规定。  

GIF 数据流必须在上下文中进行解释，也就是说，应用程序必须依赖数据流外部的信息来调用解码器过程。  

#### 6. 版本号    {#VerNum}

数据流标头中的版本号旨在标识解码器可以完全处理数据流所需的最小功能集。编码器应该使用包含数据流中所有数据块都使用的尽可能早的版本号。在这个文档中的每个块部分中，都有一个标记为  `需要的版本` 的条目，它指定了包含相应块的最早版本号。编码器应尽可能使用覆盖数据流中所有块的最早版本号;不必要地使用新版本号将阻碍某些解码器的处理过程。  

#### 7. 编码器    {#Encoder}

编码器就是用来创建 GIF 数据流的程序。从光栅数据和其他信息中，编码器产生用于重建原始图形所必要的控制和数据块。  

编码器有以下主要职责。  

    - 在数据流中包含重建图形所需的所有必要信息。  

    - 确保数据流用尽可能早的版本号进行标记，以覆盖其中所有块的定义;这是为了确保最多的解码器可以处理数据流。  

    - 确保以解码过程最优的方式对图形进行编码。尽可能避免冗余信息。  

    - 尽可能避免对图形进行分组，因为在解码过程中可能需要重新设置硬件参数。  

    - 将每个字段的每个位设置为零(关闭)，指定为保留。注意，逻辑屏幕描述符和图像描述符中的一些字段在版本 87a 中保留，但在版本 89a 中使用。  

#### 8. 解码器    {#Decoder}

解码器是用来处理 GIF 数据流的程序。它按顺序处理数据流，解析各种块和子块，使用控制信息设置硬件和流程参数，并解释数据以呈现图形。  

解码器有以下主要职责。  

    - 按顺序处理数据流中的每个图形，除控制信息中指定的延迟外，没有其他延迟。  

    - 将其硬件参数设置为尽可能接近数据流中包含的控制信息。  

#### 9. 守则    {#Compliance}

当且仅当编码器或解码器完全符合并正确实现与该版本相关的标准定义时，才称其符合图形交换格式的给定版本。编码器或解码器可能符合给定的版本号，而不符合某些后续版本。  

#### 10. 关于建议    {#AboutRecom}

本文档中的每个区块部分都包含一个标记为“推荐”的条目;本节列出了一组建议，旨在指导和组织特定块的使用。这些建议是为了使编码器和解码器的功能更有效，以及最佳地利用通信带宽。建议遵循这些建议。  

#### 11. 关于颜色表    {#AboutColorTable}

GIF格式利用颜色表来渲染基于光栅的图形。颜色表可以有两种作用域:全局作用域或局部作用域。全局颜色表用于数据流中没有与之关联的局部颜色表的所有图形。全局颜色表的范围是整个数据流。一个局部颜色表总是与紧跟着它的图形相关联;局部颜色表的范围仅限于那一个图形。局部颜色表取代全局颜色表，即如果数据流包含全局颜色表，而图像有关联的局部颜色表，解码器必须保存全局颜色表，使用局部颜色表渲染图像，然后恢复全局颜色表。这两种颜色表都是可选的，使得数据流可以在没有颜色表的情况下包含大量图形。出于这个原因，建议解码器保存使用的最后一个全局颜色表，直到遇到另一个全局颜色表。这样，既不包含全局颜色表也不包含局部颜色表的数据流可以使用保存的最后一个全局颜色表进行处理。如果使用了来自前一个流的全局颜色表，该表将成为当前流的全局颜色表。这是为了减少由颜色表引起的开销。特别是，如果相关数据流中的所有图像都可以用同一个表呈现，建议编码器只使用一个全局颜色表。如果根本没有可用的颜色表，解码器可以自由使用系统颜色表或它自己的表。在这种情况下，解码器可以使用具有其硬件所能支持的尽可能多的颜色的颜色表;建议这样的表的前两项是黑色和白色的，这样就可以充分地渲染单色图像。  

GIF格式的定义允许数据流只包含标题、逻辑屏幕描述符、全局颜色表和GIFTrailer。这样的数据流将用于加载带有全局颜色表的解码器，为后续没有任何颜色表的数据流做准备。  

#### 12. 块，扩展和作用域    {#BlockExtensionsScope}

块可以分为三组:控制块，图形渲染块和特殊用途块。控制块，如头部、逻辑屏幕描述符、图形控制扩展和Trailer，包含用于控制数据流过程的信息或用于设置硬件参数的信息。图形渲染块，像图像描述符和纯文本扩展等，包含用于在显示设备上呈现图形的信息和数据。特殊目的块，像注释扩展和应用程序扩展，既不用于控制数据流的过程，也不包含用于在显示设备上呈现图形的信息或数据。除了逻辑屏幕描述符和全局颜色表的作用域是整个数据流外，其它所有其他控制块的作用域都是有限的，仅限于它们后面的图形渲染块。特殊目的块不划分任何控制块的范围;特殊目的块对解码过程是透明的。图形渲染块和扩展被用作控制块和扩展的范围分隔符。用于标识标记块的标签分为三个范围:0x00-0x7F(0-127) 是图形渲染块，不包括 Trailer(0x3B);0x80-0xF9(128-249) 是控制块; 0xFA-0xFF(250-255) 是特殊用途块。定义这些范围是为了使解码器能够通过适当地识别块标签来处理块作用域，即使在块本身不能被处理的情况下也是如此。  

#### 13. 块大小    {#BlockSize}

块中的块大小字段用于计算块中剩余的字节数，不包括块大小字段本身，也不包括块终止符(如果有的话)。数据块以外的块的长度是固定的;提供块大小字段是为了方便跳过它们，而不是允许它们的大小在未来更改。数据块和子块的长度是可变的，以适应数据量。  

#### 14. 使用GIF作为嵌入式协议    {#AsEmbeddedProtocol}

作为一种嵌入式协议，GIF 可能是更大的应用程序协议的一部分，在这些协议中，GIF 被用来渲染图形。在这种情况下，应用程序协议可以定义一个包含GIF数据流的块。然后，应用程序将在遇到 GIF 类型的块时调用 GIF 解码器。推荐使用这种方法来支持使用应用程序扩展 (Application Extensions)，这会成为所有其他不处理它们的应用程序的开销。因为 GIF 数据流必须在上下文中处理，所以应用程序必须依赖于在流本身之外识别 GIF 数据流的一些方法。  

#### 15. 数据子块    {#DataSubBlock}

    a. 描述。数据子块是包含数据的单元。它们没有标签，这些块在那些格式中指定了数据块的控制块的上下文中处理。Data 子块的第一个字节表示后面的数据字节数。一个数据子块可以包含 0 到 255 个数据字节。块的大小不包含块大小字节本身，因此，空子块地一个块大小字节为 0x00 的子块。  

    b. 需要的版本。87a。

    c. 语法规则。
    
            7 6 5 4 3 2 1 0    Field Name    Type  
            +--------------+  
        0   |                      |    Block Size    Byte  
            +--------------+  
        1   |                      |  
            +-                  -+  
        2   |                      |  
            +-                  -+  
        3   |                      |  
            +-                  -+  
             |                      |    Data Values    Byte  
            +-                  -+  
        up|                     |  
            +-   . . . .      -+  
        to |                     |  
            +-                 -+  
             |                      |  
            +-                 -+  
        255|                   |  
            +-------------+  

        i) 块大小 - 数据子块中的字节数;大小必须在 0 到 255 字节之间，闭区间。  

        ii) 数据值 - 任何 8 位值。必须有与块大小字段指定的相同数量的数据值。  
    
    d. 扩展和作用域。这种类型的块总是作为较大单元的一部分出现。它没有自己的作用域。  

    e. 建议。无。

#### 16. 块结束符    {#BlockTerminator}  

    a. 描述。此零长度数据子块用于终止数据子块序列。它在块大小字段的位置上包含一个字节，不包含数据。  

    b. 需要的版本。87a。

    c. 语法规则。
    
            7 6 5 4 3 2 1 0    Field Name    Type  
            +--------------+  
        0   |                      |    Block Size    Byte  
            +--------------+    

        i) 块大小 - 数据子块中的字节数;这个字段包含固定的值 0x00。  

        ii) 数据值 - 这个块不包含任何数据。  
    
    d. 扩展和作用域。此块终止紧挨着前面的数据子块序列。此块不能被任何扩展修改。  

    e. 建议。无。

#### 17. 头    {#Header}  

    a. 描述。头部在上下文中标识 GIF 数据流。签名字段标记了数据流的开始，版本字段标识了解码器完全处理数据流所需的一组功能。这个块是 必须的;每个数据流必须有一个头部。  

    b. 需要的版本。不适用。此块不受版本号的约束。此块必须出现在每个数据流的开头。

    c. 语法规则。
    
            7 6 5 4 3 2 1 0    Field Name    Type  
            +--------------+  
        0   |                      |    签名    3字节  
            +-                  -+  
        1   |                      |  
            +-                  -+  
        2   |                      |  
            +-                  -+  
        3   |                      |  
            +--------------+  
        4   |                      |    版本    3字节  
            +-                  -+  
        5   |                     |  
            +-                 -+  
        6   |                     |  
            +-------------+  

        i) 签名 - 标识 GIF 数据流;这个字段包含固定值 'GIF'。  

        ii) 版本 - 用于格式化数据流的版本号。标识解码器完全处理数据流内容所需的最小功能集。  
            1990年7月10号的版本号："87a" - 1987.5
                                                            "89a" - 1990.7
            版本号的顺序是从87开始的前两位数字递增(87,88，…，99,00，…，85,86)，从第三个字符开始按字母递增。  

        iii) 扩展和作用域。这个块的作用域是整个数据流。此块不能被任何扩展修改。  

    d. 建议。
        
        i) 签名 - 该字段标识GIF数据流的开始;它不打算为识别数据提供唯一的签名。建议GIF数据流由应用程序在外部识别。(GIF数据流的在线识别请参阅附录G。)  

        ii) 版本 - 编码器：编码器应该使用尽可能早的版本号，该版本号定义了数据流中使用的所有块。当组合两个或多个数据流时，应对结果数据流使用最新的单个版本号。解码器：解码器应尽量处理数据流;如果遇到它无法完全处理的版本号，它应该在警告用户数据可能是不完整的之后，尝试尽其最大能力处理数据流。  
    
#### 18. 逻辑屏幕标识符    {#LogicalScreenDes}

    a. 描述。逻辑屏幕标识符包含定义显示设备的区域所需的参数，图像将在该区域内呈现。该块中的坐标是相对于虚拟屏幕的左上角给出的;它们不一定指的是显示设备上的绝对坐标。这意味着它们可以在基于窗口的环境中引用窗口坐标，也可以在使用打印机时引用打印机坐标。  

        这个块是必须的;每个数据流必须有一个逻辑屏幕标识符。  

    b. 需要的版本。不适用。此块不受版本号的约束。此块必须出现在紧跟头部的后边。  

    c. 语法规则。
    
            7 6 5 4 3 2 1 0    Field Name    Type  
            +--------------+  
        0   |                      |    逻辑屏幕宽    无符号  
            +-                  -+  
        1   |                      |  
            +--------------+  
        2   |                      |    逻辑屏幕高    无符号  
            +-                  -+  
        3   |                      |  
            +--------------+  
        4   ||      ||            |    <packed Fields>    见下方  
            +--------------+  
        5   |                     |    背景色索引    字节  
            +--------------+  
        6   |                     |    像素宽高比    字节  
            +-------------+  

        <Packed Fields>  =  全局颜色表标志位    1比特  
                            颜色分辨率    3比特  
                            排序标志位    1比特  
                            全局颜色表大小    3比特  

        i) 逻辑屏幕宽 - 图像将在显示设备中渲染的逻辑屏幕的宽度(以像素为单位)。  

        ii) 逻辑屏幕高 - 图像将在显示设备中渲染的逻辑屏幕的高度(以像素为单位)。  

        iii) 全局颜色表标志位 - 指示存在全局颜色表的标志;如果设置了该标志位，则全局颜色表将立即跟随逻辑屏幕标识符。该标志位还选择背景颜色索引的解释;如果设置了该标志位，则背景色索引字段的值应作为背景色的表索引。(这个字段是字节的最高位。)  

        值：0 - 后面没有全局颜色表，背景色索引字段没有意义。  
                 1 - 后面紧跟一个全局颜色表，背景色索引字段是有意义的。  

        iv) 颜色分辨率 - 原始图像每个原色可用的比特数，减 1。这个值表示从图形中选择颜色的整个调色板的大小，而不是图形中实际使用的颜色的数量。例如，如果这个字段中的值是 3，那么原始图像的调色板每个原色有 4 位可用来创建图像。应该设置此值以指示原始调色板的丰富程度，即使不是整个调色板中的所有颜色都可以在源计算机上使用。

        v) 排序标志位 - 指示是否对全局颜色表进行了排序。如果设置了该标志位，则会按重要性递减的顺序对全局颜色表进行排序。通常情况下，顺序是频率递减，最频繁的颜色在前面。这有助于解码器在可用颜色较少的情况下选择最佳的颜色子集;解码器可以使用表的初始段来呈现图形。

        值：0 - 未排序。
                 1 - 按重要性程序递减排序。最重要的颜色在最先。
        
        vi) 全局颜色表大小 - 如果全局颜色表标志位设置为1，则该字段的值用于计算全局颜色表所包含的字节数。要确定颜色表的实际大小，将2取[该字段的值+ 1]次冥。即使没有指定全局颜色表，也可以按照上述公式设置该字段，以便解码器可以选择最好的图形模式来显示流。(该字段由字节中最低有效的3位组成。)   

        vii) 背景色索引 - 背景色在全局颜色表中的索引。背景色是用于屏幕上没有被图像覆盖的像素的颜色。如果全局颜色表标志位设置为(零)，该字段应该为零并且应该被忽略。

        viii) 像素宽高比 - 用于计算原始图像中像素的纵横比近似值的因子。如果字段的值不为0，则根据公式计算长宽比的近似值：  

        Aspect Ratio = (Pixel Aspect Ratio + 15) / 64

        像素长宽比被定义为像素的宽度除以它的高度的商。该字段的值范围允许最宽像素为4:1，最高像素为1:4，增量为1/64。

        值：0 - 未给出宽高比信息。
                 1..255 - 计算中使用的值。

    d. 扩展和作用域。这个块的作用域是整个数据流。此块不能被任何扩展修改。

    e. 建议。无。 

#### 19. 全局颜色表    {#GlobalColorTable}

    a. 描述。该块包含一个颜色表，它是表示红绿蓝三元组的字节序列。全局颜色表用于没有局部颜色表的图像和纯文本扩展。它的存在是通过在逻辑屏幕描述符中设置为1的全局颜色表标志来标记的;如果存在，它立即在逻辑屏幕描述符后面，并且它包含的字节数等于

    3 x 2^(全局颜色表大小+1) 。

    这个块是可选的;每个数据流最多可以有一个全局颜色表 。

    b. 需要的版本。87a。

    c. 语法规则。
    
            7 6 5 4 3 2 1 0    Field Name    Type  
            +--------------+  
        0   |                      |    红    Byte  
            +-                  -+  
        1   |                      |    绿    Byte  
            +-                  -+  
        2   |                      |    蓝    Byte 
            +-                  -+  
        3   |                      |    红1    Byte  
            +-                  -+  
             |                      |    绿1    Byte  
            +-                  -+  
        up|                     |  
            +-   . . . .      -+  
        to |                     |  
            +-                 -+  
             |                      |    绿255    Byte  
            +-                 -+  
        767|                   |    蓝255    Byte  
            +-------------+  
    
    d. 扩展和作用域。这个块的作用域是整个数据流。此块不能被任何扩展修改。  

    e. 建议。无。

#### 20. 图像标识符    {#ImageDes}

    a. 描述。数据流中的每个图像都由一个图像标识符、一个可选的局部颜色表和图像数据组成。每个图像必须符合逻辑屏幕的边界，如逻辑屏幕描述符中定义的那样。  

    图像描述符包含处理基于表的图像所需的参数。这个块中给出的坐标是指逻辑屏幕中的坐标，以像素为单位。该块是一个图形渲染块，前面可选地有一个或多个控制块，如图形控制扩展，后面可选地有一个本地颜色表;图像描述符后面总是跟着图像数据。  

    这个块是图像所必需的。数据流中的每个图像必须有一个图像描述符。每个数据流可能存在无限数量的图像。

    b. 需要的版本。87a。  

    c. 语法规则。
    
            7 6 5 4 3 2 1 0    Field Name    Type  
            +--------------+  
        0   |                      |    图像分隔符    Byte  
            +--------------+  
        1   |                      |    图像左边位置    无符号  
            +-                  -+  
        2   |                      |  
            +--------------+  
        3   |                      |    图像右边位置    无符号  
            +-                  -+  
        4   |                      |  
            +--------------+  
        5   |                      |    图像宽    无符号  
            +-                  -+  
        6   |                      |  
            +--------------+  
        7   |                      |    图像高    无符号  
            +-                  -+  
        8   |                      |  
            +--------------+  
        9   | | | |  |            |    <Packed Fields>    见下方  
            +--------------+  

        <Packed Fields>  =      Local Color Table Flag        1 Bit
                             Interlace Flag                1 Bit
                             Sort Flag                     1 Bit
                             Reserved                      2 Bits
                             Size of Local Color Table     3 Bits












